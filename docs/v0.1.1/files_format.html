
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Files Format · DataAxesFormats.jl v0.1.1
</title>
<meta name="title" content="Files Format · DataAxesFormats.jl v0.1.1"/>
<meta property="og:title" content="Files Format · DataAxesFormats.jl v0.1.1"/>
<meta property="twitter:title" content="Files Format · DataAxesFormats.jl v0.1.1"/>
<meta name="description" content="Documentation for DataAxesFormats.jl v0.1.1."/>
<meta property="og:description" content="Documentation for DataAxesFormats.jl v0.1.1."/>
<meta property="twitter:description" content="Documentation for DataAxesFormats.jl v0.1.1."/>
<script data-outdated-warner src="assets/warner.js">
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/>
<script>documenterBaseURL="."
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js">
</script>
<script src="search_index.js">
</script>
<script src="siteinfo.js">
</script>
<script src="../versions.js">
</script>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/>
<script src="assets/themeswap.js">
</script>
</head>
<body>
<div id="documenter">
<nav class="docs-sidebar">
<a class="docs-logo" href="index.html">
<img src="assets/logo.svg" alt="DataAxesFormats.jl v0.1.1 logo"/>
</a>
<div class="docs-package-name">
<span class="docs-autofit">
<a href="index.html">DataAxesFormats.jl v0.1.1
</a>
</span>
</div>
<button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)
</button>
<ul class="docs-menu">
<li>
<a class="tocitem" href="index.html">Daf
</a>
</li>
<li>
<a class="tocitem" href="readers.html">Readers
</a>
</li>
<li>
<a class="tocitem" href="writers.html">Writers
</a>
</li>
<li>
<a class="tocitem" href="read_only.html">Read-only
</a>
</li>
<li>
<a class="tocitem" href="queries.html">Queries
</a>
</li>
<li>
<a class="tocitem" href="tokens.html">Tokens
</a>
</li>
<li>
<a class="tocitem" href="views.html">Views
</a>
</li>
<li>
<a class="tocitem" href="chains.html">Chains
</a>
</li>
<li>
<a class="tocitem" href="computations.html">Computations
</a>
</li>
<li>
<a class="tocitem" href="copies.html">Copies
</a>
</li>
<li>
<a class="tocitem" href="concat.html">Concat
</a>
</li>
<li>
<a class="tocitem" href="adapters.html">Adapters
</a>
</li>
<li>
<a class="tocitem" href="contracts.html">Contracts
</a>
</li>
<li>
<a class="tocitem" href="formats.html">Formats
</a>
</li>
<li>
<a class="tocitem" href="keys.html">Keys
</a>
</li>
<li>
<a class="tocitem" href="memory_format.html">Memory Format
</a>
</li>
<li>
<a class="tocitem" href="h5df_format.html">H5DF Format
</a>
</li>
<li class="is-active">
<a class="tocitem" href="files_format.html">Files Format
</a>
<ul class="internal">
<li>
<a class="tocitem" href="#Index">
<span>Index
</span>
</a>
</li>
</ul>
</li>
<li>
<a class="tocitem" href="anndata_format.html">AnnData Format
</a>
</li>
<li>
<a class="tocitem" href="reconstruction.html">Reconstruction
</a>
</li>
<li>
<a class="tocitem" href="registry.html">Operations registry
</a>
</li>
<li>
<a class="tocitem" href="operations.html">Query operations
</a>
</li>
<li>
<a class="tocitem" href="storage_types.html">Storage types
</a>
</li>
<li>
<a class="tocitem" href="matrix_layouts.html">Matrix layouts
</a>
</li>
<li>
<a class="tocitem" href="groups.html">Groups
</a>
</li>
<li>
<a class="tocitem" href="messages.html">Messages
</a>
</li>
<li>
<a class="tocitem" href="generic_logging.html">Generic Logging
</a>
</li>
<li>
<a class="tocitem" href="generic_locks.html">Generic Locks
</a>
</li>
<li>
<a class="tocitem" href="generic_types.html">Generic Types
</a>
</li>
<li>
<a class="tocitem" href="generic_functions.html">Generic Functions
</a>
</li>
<li>
<a class="tocitem" href="example_data.html">Example data
</a>
</li>
</ul>
<div class="docs-version-selector field has-addons">
<div class="control">
<span class="docs-label button is-static is-size-7">Version
</span>
</div>
<div class="docs-selector control is-expanded">
<div class="select is-fullwidth is-size-7">
<select id="documenter-version-selector">
</select>
</div>
</div>
</div>
</nav>
<div class="docs-main">
<header class="docs-navbar">
<a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#">
</a>
<nav class="breadcrumb">
<ul class="is-hidden-mobile">
<li class="is-active">
<a href="files_format.html">Files Format
</a>
</li>
</ul>
<ul class="is-hidden-tablet">
<li class="is-active">
<a href="files_format.html">Files Format
</a>
</li>
</ul>
</nav>
<div class="docs-right">
<a class="docs-navbar-link" href="https://github.com/tanaylab/DataAxesFormats.jl/blob/main{path}?plain=1#L{line}" title="View the repository on GitHub">
<span class="docs-icon fa-brands">
</span>
<span class="docs-label is-hidden-touch">GitHub
</span>
</a>
<a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings">
</a>
<a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings">
</a>
</div>
</header>
<article class="content" id="documenter-page">
<h1 id="Files-Format">
<a class="docs-heading-anchor" href="#Files-Format">Files Format
</a>
<a id="Files-Format-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Files-Format" title="Permalink">
</a>
</h1>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="DataAxesFormats.FilesFormat" href="#DataAxesFormats.FilesFormat">
<code>DataAxesFormats.FilesFormat
</code>
</a> — 
<span class="docstring-category">Module
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>A 
<code>Daf
</code> storage format in disk files. This is an efficient way to persist 
<code>Daf
</code> data in a filesystem, and offers a different trade-off compared to storing the data in an HDF5 file.
</p>
<p>On the downside, this being a directory, you need to create a 
<code>zip
</code> or 
<code>tar
</code> or some other form of archive file if you want to publish it. Also, accessing 
<code>FilesDaf
</code> will consume multiple file descriptors as opposed to just one for HDF5, and, of course, HDF5 has libraries to support it in most systems.
</p>
<p>On the upside, the format of the files is so simple that it is trivial to access them from any programming environment, without requiring a complex library like HDF5. In addition, since each scalar, vector or matrix property is stored in a separate file, deleting data automatically frees the storage (unlike in an HDF5 file, where you must manually repack the file to actually release the storage). Also, you can use standard tools to look at the data (e.g. use 
<code>ls
</code> or the Windows file explorer to view the list of properties, how much space each one uses, when it was created, etc.). Most importantly, this allows using standard tools like 
<code>make
</code> to create automatic repeatable processing workflows.
</p>
<p>We use multiple files to store 
<code>Daf
</code> data, under some root directory, as follows:
</p>
<ul>
<li>
<p>The directory will contain 4 sub-directories: 
<code>scalars
</code>, 
<code>axes
</code>, 
<code>vectors
</code>, and 
<code>matrices
</code>, and a file called 
<code>daf.json
</code>.
</p>
</li>
<li>
<p>The 
<code>daf.json
</code> signifies that the directory contains 
<code>Daf
</code> data. In this file, there should be a mapping with a 
<code>version
</code> key whose value is an array of two integers. The first is the major version number and the second is the minor version number, using 
<a href="https://semver.org/">semantic versioning
</a>. This makes it easy to test whether a directory does/n&#39;t contain 
<code>Daf
</code> data, and which version of the internal structure it is using. Currently the only defined version is 
<code>[1,0]
</code>.
</p>
</li>
<li>
<p>The 
<code>scalars
</code> directory contains scalar properties, each as in its own 
<code>name.json
</code> file, containing a mapping with a 
<code>type
</code> key whose value is the data type of the scalar (one of the 
<code>StorageScalar
</code> types, with 
<code>String
</code> for a string scalar) and a 
<code>value
</code> key whose value is the actual scalar value.
</p>
</li>
<li>
<p>The 
<code>axes
</code> directory contains a 
<code>name.txt
</code> file per axis, where each line contains a name of an axis entry.
</p>
</li>
<li>
<p>The 
<code>vectors
</code> directory contains a directory per axis, containing the vectors. For every vector, a 
<code>name.json
</code> file will contain a mapping with an 
<code>eltype
</code> key specifying the type of the vector element, and a 
<code>format
</code> key specifying how the data is stored on disk, one of 
<code>dense
</code> and 
<code>sparse
</code>.
</p>
<p>If the 
<code>format
</code> is 
<code>dense
</code>, then there will be a file containing the vector entries, either 
<code>name.txt
</code> for strings (with a value per line), or 
<code>name.data
</code> for binary data (which we can memory-map for direct access).
</p>
<p>If the format is 
<code>sparse
</code>, then there will also be an 
<code>indtype
</code> key specifying the data type of the indices of the non-zero values, and two binary data files, 
<code>name.nzind
</code> containing the indices of the non-zero entries, and 
<code>name.nzval
</code> containing the values of the non-zero entries (which we can memory-map for direct access). See Julia&#39;s 
<code>SparseVector
</code> implementation for details.
</p>
</li>
<li>
<p>The 
<code>matrices
</code> directly contains a directory per rows axis, which contains a directory per columns axis, which contains the matrices. For each matrix, a 
<code>name.json
</code> file will contain a mapping with an 
<code>eltype
</code> key specifying the type of the matrix element, and a 
<code>format
</code> key specifying how the data is stored on disk, one of 
<code>dense
</code> and 
<code>sparse
</code>.
</p>
<p>If the 
<code>format
</code> is 
<code>dense
</code>, then there will be a 
<code>name.data
</code> binary file in column-major layout (which we can memory-map for direct access).
</p>
<p>If the format is 
<code>sparse
</code>, then there will also be an 
<code>indtype
</code> key specifying the data type of the indices of the non-zero values, and three binary data files, 
<code>name.colptr
</code>, 
<code>name.rowval
</code> containing the indices of the non-zero values, and 
<code>name.nzval
</code> containing the values of the non-zero entries (which we can memory-map for direct access). See Julia&#39;s 
<code>SparseMatrixCSC
</code> implementation for details.
</p>
</li>
</ul>
<p>Example directory structure:
</p>
<pre>
<code class="nohighlight hljs">example-daf-dataset-root-directory/
├─ daf.json
├─ scalars/
│  └─ version.json
├─ axes/
│  ├─ cell.txt
│  └─ gene.txt
├─ vectors/
│  ├─ cell/
│  │  ├─ batch.json
│  │  └─ batch.txt
│  └─ gene/
│     ├─ is_marker.json
│     └─ is_marker.data
└─ matrices/
   ├─ cell/
   │  ├─ cell/
   │  └─ gene/
   │     ├─ UMIs.json
   │     ├─ UMIs.colptr
   │     ├─ UMIs.rowval
   │     └─ UMIs.nzval
   └─ gene/
      ├─ cell/
      └─ gene/
</code>
</pre>
<div class="admonition is-info">
<header class="admonition-header">Note
</header>
<div class="admonition-body">
<p>All binary data is stored as a sequence of elements, in little endian byte order (which is the native order for modern CPUs), without any headers or padding. (Dense) matrices are stored in column-major layout (which matches Julia&#39;s native matrix layout).
</p>
<p>All string data is stored in lines, one entry per line, separated by a `
</p>
</div>
</div>
<p>
<code>character (regardless of the OS used).     Therefore, you can&#39;t have a line break inside an axis entry name or in a vector property value, at least not     when storing it in
</code>FilesDaf`.
</p>
<pre>
<code class="nohighlight hljs">When creating an HDF5 file to contain `Daf` data, you should specify
`;fapl=HDF5.FileAccessProperties(;alignment=(1,8))`. This ensures all the memory buffers are properly aligned for
efficient access. Otherwise, memory mapping will be **much** less efficient. A warning is therefore generated
whenever you try to access `Daf` data stored in an HDF5 file which does not enforce proper alignment.
</code>
</pre>
<p>That&#39;s all there is to it. The format is intentionally simple and transparent to maximize its accessibility by other (standard) tools. Still, it is easiest to create the data using the Julia 
<code>Daf
</code> package.
</p>
<div class="admonition is-info">
<header class="admonition-header">Note
</header>
<div class="admonition-body">
<p>The code here assumes the files data obeys all the above conventions and restrictions. As long as you only create and access 
<code>Daf
</code> data in files using 
<a href="files_format.html#DataAxesFormats.FilesFormat.FilesDaf">
<code>FilesDaf
</code>
</a>, then the code will work as expected (assuming no bugs). However, if you do this in some other way (e.g., directly using the filesystem and custom tools), and the result is invalid, then the code here may fails with &quot;less than friendly&quot; error messages.
</p>
</div>
</div>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="DataAxesFormats.FilesFormat.MAJOR_VERSION" href="#DataAxesFormats.FilesFormat.MAJOR_VERSION">
<code>DataAxesFormats.FilesFormat.MAJOR_VERSION
</code>
</a> — 
<span class="docstring-category">Constant
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>The specific major version of the 
<a href="files_format.html#DataAxesFormats.FilesFormat.FilesDaf">
<code>FilesDaf
</code>
</a> format that is supported by this code (
<code>1
</code>). The code will refuse to access data that is stored in a different major format.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="DataAxesFormats.FilesFormat.MINOR_VERSION" href="#DataAxesFormats.FilesFormat.MINOR_VERSION">
<code>DataAxesFormats.FilesFormat.MINOR_VERSION
</code>
</a> — 
<span class="docstring-category">Constant
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>The maximal minor version of the 
<a href="files_format.html#DataAxesFormats.FilesFormat.FilesDaf">
<code>FilesDaf
</code>
</a> format that is supported by this code (
<code>0
</code>). The code will refuse to access data that is stored with the expected major version (
<code>1
</code>), but that uses a higher minor version.
</p>
<div class="admonition is-info">
<header class="admonition-header">Note
</header>
<div class="admonition-body">
<p>Modifying data that is stored with a lower minor version number 
<strong>may
</strong> increase its minor version number.
</p>
</div>
</div>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="DataAxesFormats.FilesFormat.FilesDaf" href="#DataAxesFormats.FilesFormat.FilesDaf">
<code>DataAxesFormats.FilesFormat.FilesDaf
</code>
</a> — 
<span class="docstring-category">Type
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">FilesDaf(
    path::AbstractString,
    mode::AbstractString = &quot;r&quot;;
    [name::Maybe{AbstractString} = nothing]
)
</code>
</pre>
<p>Storage in disk files in some directory.
</p>
<p>When opening an existing data set, if 
<code>name
</code> is not specified, and there exists a &quot;name&quot; scalar property, it is used as the name. Otherwise, the 
<code>path
</code> will be used as the name.
</p>
<p>The valid 
<code>mode
</code> values are as follows (the default mode is 
<code>r
</code>):
</p>
<table>
<tr>
<th style="text-align: left">Mode
</th>
<th style="text-align: left">Allow modifications?
</th>
<th style="text-align: left">Create if does not exist?
</th>
<th style="text-align: left">Truncate if exists?
</th>
<th style="text-align: left">Returned type
</th>
</tr>
<tr>
<td style="text-align: left">
<code>r
</code>
</td>
<td style="text-align: left">No
</td>
<td style="text-align: left">No
</td>
<td style="text-align: left">No
</td>
<td style="text-align: left">
<a href="read_only.html#DataAxesFormats.ReadOnly.DafReadOnly">
<code>DafReadOnly
</code>
</a>
</td>
</tr>
<tr>
<td style="text-align: left">
<code>r+
</code>
</td>
<td style="text-align: left">Yes
</td>
<td style="text-align: left">No
</td>
<td style="text-align: left">No
</td>
<td style="text-align: left">
<a href="files_format.html#DataAxesFormats.FilesFormat.FilesDaf">
<code>FilesDaf
</code>
</a>
</td>
</tr>
<tr>
<td style="text-align: left">
<code>w+
</code>
</td>
<td style="text-align: left">Yes
</td>
<td style="text-align: left">Yes
</td>
<td style="text-align: left">No
</td>
<td style="text-align: left">
<a href="files_format.html#DataAxesFormats.FilesFormat.FilesDaf">
<code>FilesDaf
</code>
</a>
</td>
</tr>
<tr>
<td style="text-align: left">
<code>w
</code>
</td>
<td style="text-align: left">Yes
</td>
<td style="text-align: left">Yes
</td>
<td style="text-align: left">Yes
</td>
<td style="text-align: left">
<a href="files_format.html#DataAxesFormats.FilesFormat.FilesDaf">
<code>FilesDaf
</code>
</a>
</td>
</tr>
</table>
</div>
</section>
</article>
<h2 id="Index">
<a class="docs-heading-anchor" href="#Index">Index
</a>
<a id="Index-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Index" title="Permalink">
</a>
</h2>
<ul>
<li>
<a href="files_format.html#DataAxesFormats.FilesFormat">
<code>DataAxesFormats.FilesFormat
</code>
</a>
</li>
<li>
<a href="files_format.html#DataAxesFormats.FilesFormat.MAJOR_VERSION">
<code>DataAxesFormats.FilesFormat.MAJOR_VERSION
</code>
</a>
</li>
<li>
<a href="files_format.html#DataAxesFormats.FilesFormat.MINOR_VERSION">
<code>DataAxesFormats.FilesFormat.MINOR_VERSION
</code>
</a>
</li>
<li>
<a href="files_format.html#DataAxesFormats.FilesFormat.FilesDaf">
<code>DataAxesFormats.FilesFormat.FilesDaf
</code>
</a>
</li>
</ul>
</article>
<nav class="docs-footer">
<a class="docs-footer-prevpage" href="h5df_format.html">« H5DF Format
</a>
<a class="docs-footer-nextpage" href="anndata_format.html">AnnData Format »
</a>
<div class="flexbox-break">
</div>
<p class="footer-message">Powered by 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> and the 
<a href="https://julialang.org/">Julia Programming Language
</a>.
</p>
</nav>
</div>
<div class="modal" id="documenter-settings">
<div class="modal-background">
</div>
<div class="modal-card">
<header class="modal-card-head">
<p class="modal-card-title">Settings
</p>
<button class="delete">
</button>
</header>
<section class="modal-card-body">
<p>
<label class="label">Theme
</label>
<div class="select">
<select id="documenter-themepicker">
<option value="auto">Automatic (OS)
</option>
<option value="documenter-light">documenter-light
</option>
<option value="documenter-dark">documenter-dark
</option>
<option value="catppuccin-latte">catppuccin-latte
</option>
<option value="catppuccin-frappe">catppuccin-frappe
</option>
<option value="catppuccin-macchiato">catppuccin-macchiato
</option>
<option value="catppuccin-mocha">catppuccin-mocha
</option>
</select>
</div>
</p>
<hr/>
<p>This document was generated with 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> version 1.7.0. Using Julia version 1.10.5.
</p>
</section>
<footer class="modal-card-foot">
</footer>
</div>
</div>
</div>
</body>
</html>
